[
  {
    "id" : "c63e8cbd-55bf-4cf8-a16b-76abbe5039cb",
    "prId" : 48024,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48024#pullrequestreview-725606849",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a38e947c-a001-4671-8047-cf95a6038e26",
        "parentId" : null,
        "authorId" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "body" : "Sorry for the delay! This failed an internal check. We prohibit usage of `cc_binary` here because the rule could fail with undefined symbols when TensorFlow is linked to other repositories downstream. \r\n\r\nI can think of two fixes\r\n1. Change to `tf_cc_shared_object` instead (or `tf_cc_binary` if we don't actually need `linkshared`). \r\n2. Use `tf_native_cc_binary` since this target (and `//tensorflow/core/platform:cpu_feature_guard`) doesn't really depend on TensorFlow targets. \r\n\r\nI've tried Fix#1 and IIRC 3 test targets got a segfault:\r\n```\r\nbazel test --config=opt //tensorflow/python/distribute:packed_distributed_variable_test\r\nbazel test --config=opt //tensorflow/python/distribute:values_v2_test \r\nbazel test --config=opt //tensorflow/python/eager:function_test\r\n```\r\n\r\nFix#2 caused some internal tests to fail. I'm still investigating why. Would you mind helping take a look at #1 while I look at #2? Thank you very much!\r\n",
        "createdAt" : "2021-08-09T16:56:40Z",
        "updatedAt" : "2021-08-09T16:57:32Z",
        "lastEditedBy" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "tags" : [
        ]
      }
    ],
    "commit" : "e3594cff84b705bf3af2312bf43fa3598244b635",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +34,38 @@)\n\ncc_binary(\n    name = \"_cpu_feature_guard.so\",\n    linkshared = True,"
  }
]